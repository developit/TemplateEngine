/*! TemplateEngine 30-06-2014 */
var engine={extendedKeys:!0,helpers:{link:'<a href="{{href}}">{{title}}</a>',html:function(a){return String(a).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},escape:function(a){return encodeURIComponent(a)},json:function(a){return JSON.stringify(a)}},refs:{},blockHelpers:{each:function(a){var b,c,d="",e=a.fields,f=a.value;engine.extendedKeys!==!1&&(c={"~":e,__path__:"."===a.id?a.path:a.id});for(b in f)f.hasOwnProperty(b)&&(c&&(c.__key__=b),d+=engine.template(a.content,f[b],c));return d},"if":function(a){return a.value?engine.template(a.content,a.fields,a.overrides):""},"else":function(a){return a.value?"":engine.template(a.content,a.fields,a.overrides)},unless:function(a){return this["else"](a)}},template:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=/\{\{\{?([#\/\:]?)([^ \{\}\|]+)(?: ([^\{\}\|]*?))?(?:\|([^\{\}]*?))?\}?\}\}/g,n="",o=[];for(l={fields:b||{},overrides:c||engine._emptyObj},l.path=(l.overrides.__path__?l.overrides.__path__+".":"")+l.overrides.__key__,m.lastIndex=0;j=m.exec(a);){if(0===o.length&&(n+=a.substring(h||0,m.lastIndex-j[0].length)),d=j[1],!d||"#"!==d&&":"!==d&&"/"!==d){if(g=j[2],0===o.length)if(f=d?engine.refs[d](b,g,null):l.overrides[g]||engine.delve(b,g,null),null===f)n+=j[0];else{if(k="{"!==j[0].charAt(2),j[4])for(i=j[4].split("|"),e=0;e<i.length;e++)engine.helpers.hasOwnProperty(i[e])&&("html"===i[e]&&(k=!1),f=engine.execHelper(i[e],f));k&&(f=engine.helpers.html(f)),n+=f}}else("/"===d||":"===d)&&(l.id=o.pop(),l.value=l.overrides[l.id]||engine.delve(b,l.id,null),0===o.length&&(l.content=a.substring(l.blockStart,m.lastIndex-j[0].length),f=engine.blockHelpers[l.blockHelper](l),f&&"string"==typeof f&&(n+=f)),l.previousBlockHelper=l.blockHelper,l.previousId=l.id,l.previousValue=l.value),("#"===d||":"===d)&&(o.push(":"===d?l.id:j[3]),1===o.length&&(l.blockHelper=j[2],l.blockStart=m.lastIndex),h=null);h=m.lastIndex}return n+=a.substring(h)},keyPath:/(\.{2,}|\[(['"])([^\.]*?)\1\])/g,trimDots:/(^\.|\.$)/g,execHelper:function(a,b){var c=a.split(":"),d=c[0],e=engine.helpers[d];return"string"==typeof e?engine.template(e,b):(c.splice(0,1,b),e.apply(engine.helpers,c))},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},copy:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},delve:function(a,b,c){var d,e,f=a;if("."===b)return a.hasOwnProperty(".")?a["."]:a;if(-1===b.indexOf("."))return a.hasOwnProperty(b)?a[b]:c;for(-1!==b.indexOf("[")&&(b=b.replace(engine.keyPath,".$2")),b=b.replace(engine.trimDots,"").split("."),d=0,e=b.length;e>d;d++){if(!f.hasOwnProperty(b[d]))return c;f=f[b[d]]}return f},_emptyObj:{}};"function"==typeof define&&define.amd&&define("templateengine",function(){return engine}),"object"==typeof module&&(module.exports=self);