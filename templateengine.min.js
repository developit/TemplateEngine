/*! TemplateEngine 03-03-2014 */
var engine={extendedKeys:!0,helpers:{link:'<a href="{{href|html}}">{{title|html}}</a>',html:function(a){return String(a).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},escape:function(a){return encodeURIComponent(a)},json:function(a){return JSON.stringify(a)}},refs:{"@":function(a,b,c){return engine.devle(a,"locale."+b,c)}},blockHelpers:{each:function(a){var b,c,d="",e=a.fields,f=a.value;engine.extendedKeys!==!1&&(c={"~":e,__path__:"."===a.id?a.path:a.id});for(b in f)f.hasOwnProperty(b)&&(c&&(c.__key__=b),d+=engine.template(a.content,f[b],c));return d},"if":function(a){return a.value?engine.template(a.content,a.fields,a.overrides):""},"else":function(a){return a.value?"":engine.template(a.content,a.fields,a.overrides)}},template:function(a,b,c){var d,e,f,g,h,i,j,k,l=/\{\{\{?([#\/\:]?)([^ \{\}\|]+)(?: ([^\{\}\|]*?))?(?:\|([^\{\}]*?))?\}?\}\}/g,m="",n=[];for(k={fields:b||{},overrides:c||engine._emptyObj},k.path=(k.overrides.__path__?k.overrides.__path__+".":"")+k.overrides.__key__,l.lastIndex=0;j=l.exec(a);){if(0===n.length&&(m+=a.substring(h||0,l.lastIndex-j[0].length)),d=j[1],!d||"#"!==d&&":"!==d&&"/"!==d){if(g=j[2],0===n.length)if(f=d?engine.refs[d](b,g,null):k.overrides[g]||engine.delve(b,g,null),null===f)m+=j[0];else{if(j[4])for(i=j[4].split("|"),e=0;e<i.length;e++)engine.helpers.hasOwnProperty(i[e])&&(f=engine.execHelper(i[e],f));"{"===j[0].charAt(2)&&(f=engine.helpers.html(f)),m+=f}}else("/"===d||":"===d)&&(k.id=n.pop(),k.value=k.overrides[k.id]||engine.delve(b,k.id,null),0===n.length&&(k.content=a.substring(k.blockStart,l.lastIndex-j[0].length),f=engine.blockHelpers[k.blockHelper](k),f&&"string"==typeof f&&(m+=f)),k.previousBlockHelper=k.blockHelper,k.previousId=k.id,k.previousValue=k.value),("#"===d||":"===d)&&(n.push(":"===d?k.id:j[3]),1===n.length&&(k.blockHelper=j[2],k.blockStart=l.lastIndex),h=null);h=l.lastIndex}return m+=a.substring(h)},keyPath:/(\.{2,}|\[(['"])([^\.]*?)\1\])/g,trimDots:/(^\.|\.$)/g,execHelper:function(a,b){var c=a.split(":"),d=c[0],e=engine.helpers[d];return"string"==typeof e?engine.template(e,b):(c.splice(0,1,b),e.apply(engine.helpers,c))},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},copy:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},delve:function(a,b,c){var d,e,f=a;if("."===b)return a.hasOwnProperty(".")?a["."]:a;if(-1===b.indexOf("."))return a.hasOwnProperty(b)?a[b]:c;for(-1!==b.indexOf("[")&&(b=b.replace(engine.keyPath,".$2")),b=b.replace(engine.trimDots,"").split("."),d=0,e=b.length;e>d;d++){if(!f.hasOwnProperty(b[d]))return c;f=f[b[d]]}return f},_emptyObj:{}};"function"==typeof window.define&&window.define.amd&&window.define("templateengine",function(){return engine});